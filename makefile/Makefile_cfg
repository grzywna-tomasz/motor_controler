include Makefile_scope

TARGET_NAME = motor_controller

BUILD_DIR = ../Build

ifeq ($(DEBUG), TRUE)
    OPTIM_LEVEL = -Og -g -gdwarf-2
else
    OPTIM_LEVEL = -O2
endif

COMPILER_PATH = $(subst \,/,$(ARM_NONE_EABI))

CC = $(COMPILER_PATH)/arm-none-eabi-gcc
AS = $(COMPILER_PATH)/arm-none-eabi-gcc -x assembler-with-cpp
CP = $(COMPILER_PATH)/arm-none-eabi-objcopy
SZ = $(COMPILER_PATH)/arm-none-eabi-size

# defines related to autogenerated code
C_DEFINES = -DUSE_HAL_DRIVER \
            -DSTM32F401xC

# MCU architecture, float support and 32 bit instruction sellected
MCU_FLAGS = -mcpu=cortex-m4 \
            -mfpu=fpv4-sp-d16 \
            -mfloat-abi=hard \
            -mthumb

# Flags for C compiler
C_FLAGS =   $(MCU_FLAGS) \
            $(OPTIM_LEVEL) \
            $(C_DEFINES) \
            $(addprefix -I, $(HEADERS)) \
            -Wall \
            -MMD -MP -MF"$(@:%.o=%.d)"

ASM_FLAGS = $(MCU_FLAGS) \
            $(OPTIM_LEVEL) \
            $(addprefix -I, $(HEADERS)) \
            -Wall

LD_FLAGS =  $(MCU_FLAGS) \
            -specs=nano.specs -T$(LDSCRIPT) -lnosys -Wl,-Map=$(BUILD_DIR)/$(TARGET_NAME).map,--cref -Wl,--gc-sections
